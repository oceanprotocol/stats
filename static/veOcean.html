<html>

<head>
	<script type="text/javascript" src=
"https://code.jquery.com/jquery-1.12.0.min.js">
	</script>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,
								initial-scale=1">
	<script src=
"https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js">
	</script>
	<title>VeOcean</title>
</head>

<body>
    
	
    <div class="chart-container" style="position: relative; height:300; width:800">
        <canvas id="weeklyLocked"></canvas>
    </div>
	<div><br><br><br><br><br></div>
    <div class="chart-container" style="position: relative; height:300; width:800">
        <canvas id="deposits"></canvas>
    </div>
    <div><br><br><br><br><br></div>
    <div class="chart-container" style="position: relative; height:300; width:800">
        <canvas id="actions"></canvas>
    </div>
	<div><br><br><br><br><br></div>
    <div class="chart-container" style="position: relative; height:300; width:800">
        <canvas id="allocations"></canvas>
    </div>
	<script>

		getWeeklyLocked();
        getActions();
        getDeposits();
		getAllocations();
		
        
        async function getWeeklyLocked() {
            const response = await fetch('/api/veOcean/weeklyLockedAmount');
            const data = await response.json();
			
			

			labels = [];
			values = [];
            for (const [key, value] of Object.entries(data)){
                labels.push(key)
                values.push(value)
            }
			new Chart(document.getElementById("weeklyLocked"), {
				type: 'bar',
				data: {
					labels: labels,
					datasets: [
						{
							label: "veOcean weekly locked",
							data: values
						}
					]
				},
				options: {
					locale: 'en-US',
					legend: { display: false },
					title: {
						display: true,
						text: 'veOcean locked per week'
					}
				}
			});
        }
		async function getDeposits() {
			const response = await fetch('/api/veOcean/deposits');
			const data = await response.json();
			labels = [];
			deposits = []; // type = 0
			withdraws=[];//type = 4
			for (const [key, value] of Object.entries(data)){
				labels.push(key)
				deposits.push(value['0']+value['1']+value['2'])
				withdraws.push(value['4'])
            }
			new Chart(document.getElementById("deposits"), {
				type: 'bar',
				data: {
					labels: labels,
					datasets: [
						{
							label: "veOcean deposits",
							data: deposits,
							backgroundColor: '#7CFC00',
						},
						{
							label: "veOcean withdraws",
							data: withdraws,
							backgroundColor: '#FF0000',
						}
					]
				},
				options: {
					legend: { display: true },
					title: {
						display: true,
						text: 'veOcean deposits/withdraws per week'
					}
				}
				
			});
		}
		async function getActions() {
			const response = await fetch('/api/veOcean/actions');
			const data = await response.json();
			labels = [];
			deposits = []; // type = 0
			createLocks=[]; //type = 1
			increaseLockAmount=[]; // type = 2
			increaseUnlockTime=[]; // type = 3
			withdraws=[];//type = 4
			for (const [key, value] of Object.entries(data)){
				labels.push(key)
				
				deposits.push(value['0'])
				createLocks.push(value['1'])
				increaseLockAmount.push(value['2'])
				increaseUnlockTime.push(value['3'])
				withdraws.push(value['4'])
            }
			new Chart(document.getElementById("actions"), {
				type: 'bar',
				data: {
					labels: labels,
					datasets: [
						{	label: "DEPOSIT_FOR",data: deposits,backgroundColor: '#FF0000'},
						{	label: "CREATE_LOCK",data: createLocks, backgroundColor: '#196384'},
						{	label: "INCREASE_LOCK_AMOUNT",data: increaseLockAmount, backgroundColor: '#FF00FF'},
						{	label: "INCREASE_UNLOCK_TIME",data: increaseUnlockTime, backgroundColor: '#7DF9FF'},
						{	label: "WITHDRAW",data: withdraws, backgroundColor: '#FFBF00'}
					]
				},
				options: {
        			scales: {
            			xAxes: [{
              				stacked: false
            			}],
            			yAxes: [{
              				stacked: true
            			}]
          			},
					title: {
							display: true,
							text: 'veOcean actions per week'
					},
        			legend: {
            			display: true,
						
        			}
    			}
			});
		}

		
		async function getAllocations() {
			const response = await fetch('/api/veOcean/allocations');
			const data = await response.json();
			labels = [];
			allocations = [];
			uniqueUsers=[];
			txs=[];
			for (const [key, value] of Object.entries(data)){
				labels.push(key)
				
				allocations.push(value['updates'])
				uniqueUsers.push(value['unique'])
				txs.push(value['txs'])
            }
			new Chart(document.getElementById("allocations"), {
				type: 'bar',
				data: {
					labels: labels,
					datasets: [
						{	label: "No of datasets",data: allocations,backgroundColor: '#FF0000'},
						{	label: "Unique users",data: uniqueUsers, backgroundColor: '#196384'},
						{	label: "No of txs",data: txs, backgroundColor: '#FF00FF'},
					]
				},
				options: {
        			scales: {
            			xAxes: [{
              				stacked: false
            			}],
            			yAxes: [{
              				stacked: false
            			}]
          			},
					title: {
							display: true,
							text: 'Allocations per week'
					},
        			legend: {
            			display: true,
						
        			}
    			}
			});
		}
		

	</script>
</body>

</html>
